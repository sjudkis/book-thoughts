{% extends "layout.html" %}

{% block title %}
Book Thoughts
{% endblock %}

{% block body %}

<nav class="navbar navbar-light">
    <a href="{{url_for('index')}}" class="navbar-brand">Book Thoughts</a>
    <ul class="navbar-nav">
        <li class="nav-item">
            <a href="{{url_for('log_out')}}">Log Out</a>
        </li>
    </ul>
</nav>


<h3>{{book.title}} - by {{book.author}}</h3>
<h6>Year Published: {{book.pub_year}}</h6>
<h6>ISBN: {{book.isbn}}</h6>
<h6>Goodreads Rating: 
    {% if rating_data.found %}
        {{rating_data.avg}} ({{rating_data.count}} ratings)
    {% else %}
        Not Available
    {% endif %}
</h6>

{% if not review_data or not review_data[0].by_current_user%}
    <a href="{{url_for('write_review', book_id=book.id)}}">
        <button class="btn btn-primary">Write a Review</button>
    </a>
{% endif %}

<h4>User Reviews</h4>
{% if review_data %}
    {% for review in review_data%}

        <div class="user_review">

            {% if review.by_current_user %}
            <h5 class="current_user_review">Your review:</h5>
        
            {% else %}
            <h5 class="other_user_review">Review by {{review.username}}:</h5>
            {% endif %}
            <p class="user_rating">Rating: {{review.rating}} stars</p>
            <p class="review_text">{{review.review_text}}</p>

            {% if review.by_current_user %}
            <a href="{{url_for('write_review', book_id=book.id)}}">
                    <button class="btn btn-primary">Edit your review</button>
            </a>
            {% endif %}
        </div>

    {% endfor %}
{% else %}
<p>
    This book has not been reviewed yet
</p>
{% endif %}

{% if last_search %}
<a href="{{url_for('search', search_text=last_search.text, search_type= last_search.type)}}">
    <button class="btn btn-primary">Back to Search</button>
</a>
{% else %}
<form action="{{url_for('index')}}" method="GET">
        <button type="submit" class="btn btn-primary">Back</button>
</form>
{% endif %}

{% endblock %}